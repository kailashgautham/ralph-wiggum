# Ralph Self-Improvement Plan

Ralph is a self-improving loop. Each iteration, Claude reads this file and progress.txt, picks the next uncompleted task, implements it, commits the change, and marks it done.

**Important:** If all tasks are completed, review the codebase for weaknesses and append new improvement tasks to the Tasks section below before proceeding. There should always be work to do.

## Tasks
- [ ] Make git identity configurable via env vars in entrypoint.sh: entrypoint.sh hardcodes a specific person's name and email in `git config --global user.name/email`, making every commit inside the container appear to be authored by that individual regardless of who is running Ralph; add RALPH_GIT_NAME and RALPH_GIT_EMAIL env vars (defaulting to the current values so existing behaviour is preserved), substitute them into the git config calls, and forward both vars from docker-ralph.sh's ENV_ARGS block
- [ ] Extract shared git commit/push/PR logic into a sourced ralph-lib.sh helper: ralph.sh contains the commit→branch→push→PR creation workflow in two places (normal iteration and cycle-rewrite), and ralph-once.sh contains a third near-identical copy; any bug fix or enhancement to this flow currently requires three coordinated edits; extract the repeated block into a function in a new ralph-lib.sh file that both scripts source, accepting the branch name prefix and commit message as arguments
- [ ] Replace StrictHostKeyChecking=no with StrictHostKeyChecking=accept-new in entrypoint.sh: the GIT_SSH_COMMAND exported by entrypoint.sh includes `-o StrictHostKeyChecking=no`, which silently ignores changed host keys and exposes all git-over-SSH operations inside the container to man-in-the-middle attacks; change the option to `StrictHostKeyChecking=accept-new`, which trusts new hosts on first contact but correctly rejects keys that have changed since a prior connection
- [ ] Add --help / -h flag to ralph.sh, ralph-once.sh, and docker-ralph.sh: none of the three scripts respond to --help or -h; users must read source code to discover the available subcommands, env vars, and usage patterns; add a --help branch to each script that prints a concise usage summary covering subcommands, key env vars (RALPH_BASE_BRANCH, RALPH_MAX_STALLS, RALPH_TIMEOUT, etc.), and an example invocation, then exits 0
- [ ] Add input validation for numeric env vars at startup in ralph.sh and ralph-once.sh: RALPH_LOG_KEEP, RALPH_MAX_STALLS, MAX_RETRIES, and RALPH_TIMEOUT are all used in arithmetic expressions but are never validated; supplying a non-integer value (e.g. RALPH_MAX_STALLS=yes) produces a cryptic "integer expression expected" error deep inside the script rather than a clear actionable message; add a validate_int() guard at startup that checks each numeric var with a regex and prints "Error: <VAR> must be a positive integer (got '<value>')" then exits 1 if invalid
- [ ] Add RALPH_NO_PR env var to skip automatic PR creation and merge: ralph.sh and ralph-once.sh automatically create and immediately squash-merge a GitHub PR via `gh pr create --squash` after every iteration whenever a remote and the gh CLI are available; this prevents human code review and breaks repos with branch-protection rules requiring approvals; add a RALPH_NO_PR flag (default empty/false) that, when set to any non-empty value, skips PR creation entirely and leaves the pushed branch on the remote for manual review, forwarding it from docker-ralph.sh's ENV_ARGS block
- [ ] Extend tests/run_tests.sh to cover ralph-once.sh and docker-ralph.sh argument validation: the existing test harness only exercises ralph.sh; ralph-once.sh has no test coverage at all, and docker-ralph.sh's argument validation (rejecting non-integer max_iterations) is also untested; add at least two new tests: (1) verify ralph-once.sh exits non-zero with an error message when the claude binary is absent from PATH, and (2) verify docker-ralph.sh prints a clear error and exits 1 when given a non-integer max_iterations argument such as "abc"
