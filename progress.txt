# Progress Tracker
# Each completed task is logged here by the agent.
# Format: [DONE] Task description
[DONE] Restrict log rotation in ralph.sh to files with a .log extension: the mapfile in ralph.sh (line 126) uses 'ls -t "$LOGS_DIR"' which lists all files in logs/ including .tmp scratch files, progress archive .txt files, and any other artifacts, so non-log files count against RALPH_LOG_KEEP and may be unexpectedly deleted; replace the ls invocation with one that filters by extension, e.g. 'ls -t "$LOGS_DIR"/*.log 2>/dev/null', and update the accompanying test (test 12 in tests/run_tests.sh) to verify that a non-.log file placed in logs/ is not counted against the limit and is not deleted by rotation
[DONE] Fix tmpfile cleanup mismatch in handle_signal: handle_signal in ralph.sh removes '"$LOGS_DIR/claude_output_"*".tmp"' but _ralph_invoke_claude_with_retry in ralph-lib.sh creates tmpfiles via 'mktemp "${LOGS_DIR:-/tmp}/claude_XXXXXX"' which produces names like 'logs/claudeABCDEF' with no "output_" prefix and no ".tmp" suffix, so the glob in handle_signal never matches and orphaned tmpfiles accumulate on every signal exit; fix by changing the mktemp pattern in _ralph_invoke_claude_with_retry to '"${LOGS_DIR:-/tmp}/claude_output_XXXXXX.tmp"' so it matches the cleanup glob; add a test to tests/run_tests.sh that sends SIGTERM to a running ralph.sh and asserts no "claude_output_" tmpfiles remain in logs/ afterward
[DONE] Add RALPH_CREDIT_WAIT_MAX to cap indefinite credit-exhaustion retries: the credit-exhaustion branch in _ralph_invoke_claude_with_retry (ralph-lib.sh) executes 'sleep 3600; continue' without incrementing attempt or tracking wait count, so if credits are never restored the loop runs forever with no operator override; add a RALPH_CREDIT_WAIT_MAX environment variable (default 0 = unlimited) that limits the number of 1-hour credit-exhaustion waits â€” when the limit is exceeded, log a clear error message and return the last exit code rather than looping indefinitely; validate RALPH_CREDIT_WAIT_MAX as a non-negative integer alongside other env-var validation in ralph.sh; document it in ralph.sh --help, docker-ralph.sh --help (and its ENV_ARGS forwarding block), and README.md's environment variables table; add a test that sets RALPH_CREDIT_WAIT_MAX=1 and stubs a claude binary that always emits a credit-exhaustion error, and asserts that ralph.sh exits non-zero after at most one extra retry rather than hanging
