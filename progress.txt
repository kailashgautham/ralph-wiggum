# Progress Tracker
# Each completed task is logged here by the agent.
# Format: [DONE] Task description
[DONE] Add error handling and retry logic to ralph.sh (handle Claude CLI failures gracefully)
[DONE] Add logging: write each iteration's summary to a logs/ directory with timestamps
[DONE] Improve README.md with clear usage instructions, examples, and architecture overview
[DONE] Add a CLAUDE.md with project conventions and context for future Claude sessions
[DONE] Support configuring the Claude model via environment variable in ralph.sh
[DONE] Make the prompt in ralph.sh configurable via a prompt.txt file
[DONE] Add input validation to docker-ralph.sh (check Docker is installed, etc.)
[DONE] Add a .env.example documenting available environment variables
[DONE] Add a cleanup command to docker-ralph.sh to remove old containers/images
[DONE] Add git commit after each completed task in ralph.sh
[DONE] If auth error when I run docker-ralph, redirect the user to login instead to re-get the OAuth.
[DONE] Currently, ralph is not pushing code that is created. The code should always be pushed after a task is completed.
[DONE] Currently, ralph is not updating PRD.md after it completes all tasks. I need ralph to rewrite the tasks section in PRD.md every time it finishes running something, so that it goes on endlessly and doesn't end in fewer iterations.
[DONE] Why was PRD not updated?
[DONE] Add logs/ to .gitignore so run logs are never committed to the repository
[DONE] Sync ralph-once.sh with ralph.sh: read prompt from prompt.txt if it exists, respect the CLAUDE_MODEL environment variable, and git commit + push after a task completes
[DONE] Add a configurable timeout to Claude invocations in ralph.sh (e.g. via a RALPH_TIMEOUT env var using the `timeout` command) so a hung session cannot stall the loop indefinitely
[DONE] Pin versions in the Dockerfile: use a specific node image tag (e.g. node:20.19-slim) and pin @anthropic-ai/claude-code to a specific version so builds are reproducible
[DONE] Add SIGINT/SIGTERM trap to ralph.sh for graceful shutdown: on signal, log the current iteration number and exit cleanly rather than being killed mid-operation
[DONE] Add a status subcommand to ralph.sh (./ralph.sh status) that prints a summary of completed vs. remaining tasks by cross-referencing PRD.md and progress.txt
[DONE] Archive completed progress entries when PRD.md is rewritten: move current progress.txt lines into a timestamped archive file (e.g. logs/progress_archive_YYYYMMDD_HHMMSS.txt) and reset progress.txt for the new cycle, preventing unbounded growth and cross-cycle confusion
[DONE] Add Linux credential support to docker-ralph.sh setup: if the macOS `security` command is unavailable, fall back to copying credentials directly from ~/.claude/ so the setup subcommand works on Linux hosts
[DONE] Fix prompt injection risk in ralph.sh and ralph-once.sh: the PROMPT variable is interpolated directly into a double-quoted `bash -c` string, so special characters in prompt.txt (quotes, dollar signs, backticks) can break or inject into the command; pass the prompt via a temp file or environment variable instead
[DONE] Add a flock-based lockfile to ralph.sh so that a second concurrent invocation fails fast with a clear error instead of both instances corrupting progress.txt and making competing git commits
[DONE] Improve git commit messages in ralph.sh: instead of the generic "ralph: completed task (iteration N)", extract the most-recently-added [DONE] line from progress.txt and include the actual task description in the commit message
[DONE] Forward relevant environment variables (CLAUDE_MODEL, RALPH_TIMEOUT, MAX_RETRIES) from docker-ralph.sh into the container via `docker run -e` so they take effect without requiring a custom Dockerfile build
[DONE] Fix ralph-once.sh output streaming: the current `OUTPUT=$(claude ...)` captures all output silently until completion; switch to the same `tee`-based approach used in ralph.sh so progress is visible in real time
[DONE] Add pre-flight dependency checks to both ralph.sh and ralph-once.sh: before starting, verify that the `claude` and `git` binaries are in PATH and that PRD.md exists, printing a clear actionable error message and exiting non-zero if any check fails
[DONE] Sync ralph-once.sh COMPLETE handling with ralph.sh: when the output contains `<promise>COMPLETE</promise>`, rewrite PRD.md tasks via a planning Claude call and archive+reset progress.txt, instead of simply printing "All tasks complete" and exiting
[DONE] Fix ralph-once.sh commit message: extract the last [DONE] line from progress.txt and use it as the commit message (e.g. "ralph: <task description> (single iteration)") instead of the current generic hardcoded string
[DONE] Respect MAX_RETRIES environment variable in ralph.sh: the variable is forwarded by docker-ralph.sh but ralph.sh ignores it and always uses a hardcoded value of 3; read MAX_RETRIES from the environment (with 3 as the default) so callers can tune it without rebuilding the Docker image
[DONE] Add RALPH_TIMEOUT support to ralph-once.sh: ralph.sh wraps its Claude call with `timeout "$RALPH_TIMEOUT"` when the variable is set, but ralph-once.sh never does; apply the same conditional timeout so a hung single-iteration run can be interrupted
[DONE] Handle non-TTY environments in docker-ralph.sh: the `docker run` command unconditionally passes `-it`, which fails when stdout is not a terminal (CI pipelines, cron jobs, piped invocations); detect whether a TTY is available using `[ -t 1 ]` and only pass `-t` when running interactively
[DONE] Add stall detection to ralph.sh: after each iteration, compare the number of [DONE] lines in progress.txt before and after the Claude call; if the count did not increase, log a warning and increment a consecutive-stall counter; after N consecutive stalled iterations (default 3, configurable via RALPH_MAX_STALLS), exit with a non-zero code and a clear message instead of silently burning through remaining iterations
[DONE] Forward RALPH_MAX_STALLS from docker-ralph.sh into the container: docker-ralph.sh already forwards CLAUDE_MODEL, RALPH_TIMEOUT, and MAX_RETRIES via `docker run -e`, but omits RALPH_MAX_STALLS; add it to the ENV_ARGS block so callers can tune stall sensitivity without rebuilding the image
[DONE] Add a flock-based lockfile to ralph-once.sh: ralph.sh prevents concurrent runs with flock on .ralph.lock, but ralph-once.sh has no such guard; a second simultaneous invocation can corrupt progress.txt and cause competing git commits; apply the same flock pattern
[DONE] Add retry logic to the COMPLETE planning call in ralph.sh and ralph-once.sh: the main Claude invocation uses MAX_RETRIES with a delay loop, but the planning call after `<promise>COMPLETE</promise>` fires once with no retry; wrap it in the same retry loop so a transient API error doesn't abort the planning step
[DONE] Add --verbose flag to the Claude invocation in ralph-once.sh: ralph.sh passes `--verbose` so tool calls and reasoning are visible in real time, but ralph-once.sh omits it, producing sparse output; add `--verbose` to the CMD array in ralph-once.sh for consistent observability
